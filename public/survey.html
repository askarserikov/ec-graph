<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-time Energy Consumption</title>
    <link rel="stylesheet" href="stylesheet.css" type="text/css">
</head>
<body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="rangeslider.min.js"></script>
<div id="pane" class="pure-g">
    <div id="welcome-msg" class="pure-u-1-3">
        <p id="welcome-text">Hello and Welcome!</p>
        First of all, thank you for you participation!
        <br>
        The survey will take less than 5 minutes.
        <br><br>
        The goal of this survey is to understand how data visualization can affect people's perception of residential
        energy consumption.
        <br><br>
        The survey consists of two sections:
        <br>
        I. 5 questions with data presented in graphs<br>
        II. 5 questions with data presented in colored circles
        <br><br>
        Before each section you will be shown a brief instruction.<br><br>
        <b>Note</b> that all data patterns you will observe are different.
        <br><br>
        If you have any questions you can contact the authors of this survey via email: <a href="mailto:askar.serikov@student.lut.fi">askar.serikov@student.lut.fi</a>
        <br><hr>
        The survey is completely anonymous but we would like you to indicate your age group and sex for research purposes
        <br><br>
        <div id="welcome-form-wrapper">
            <form id="welcome-form" class="pure-form pure-form-aligned">
                <fieldset>

                    <label for="age"><b>Your Age Group: </b></label>
                    <select id="age">
                        <option>0-12</option>
                        <option>13-17</option>
                        <option>18-24</option>
                        <option>25-34</option>
                        <option>35-44</option>
                        <option>45-54</option>
                        <option>65-74</option>
                        <option>74+</option>
                    </select>

                    <br><br>

                    <label for="sex"><b>Your Sex: </b></label>
                    <select id="sex">
                        <option selected>Prefer not to disclose</option>
                        <option>Female</option>
                        <option>Male</option>
                    </select>

                    <br><br>

                    <button type="submit" class="pure-button pure-button-primary">Start</button>

                </fieldset>
            </form>
        </div>
    </div>
    <div id="bye" class="pure-u-1">
        <h3>Thank you for your time! Take care!</h3>
        <p>(You can close the tab now)</p>
    </div>
    <div id="finish-msg" class="pure-u-1">
        <h3 id="finish-text">Well done!</h3><br>
        <p>Click or tap the button below to submit your answers</p>
        <button class="pure-button pure-button-primary" id="finish-btn">Submit</button>
    </div>
    <div id="chart-info" class="pure-u-1">
        <div class="pure-u-18-24" id="ci-title"><h1 id="ci-text">Graph questions instruction</h1></div>
        <div id="ci-nav-bar" class="pure-u-1-2">
            In the next 5 questions, you will observe 5 graphs
            illustrating energy consumption patterns of a household over 24 hours. You can see an <b>example</b> graph below.
            <br><br>
        </div>
        <div class="pure-u-18-24" id="ci-container"></div>
        <div class="pure-u-1-2">
            The values on the horizontal (X) axis represent time of the day. The leftmost
            value <b>0</b> refers to midnight (00:00 in the 24-hour clock system) and the rightmost <b>23</b>
            refers to 23:00 or 11pm.<br><br>
            The vertical (Y) axis is for Kilowatt Hours (kWh). It represents active energy consumption for
            the given hours. The actual values are purposefully hidden from the graph.<br><br>
            <b>We ask you to observe the energy consumption patterns and evaluate them in terms of energy efficiency
                on a scale from 1 (very inefficient) to 5 (very efficient).</b>
            <br><br>
            <button id="ci-ok-btn" class="pure-button pure-button-primary">OK</button>
        </div>
    </div>
    <div id="circle-info" class="pure-u-1">
        <div class="pure-u-18-24" id="cr-title"><h1 id="cr-text">Circle questions instruction</h1></div>
        <div id="cr-nav-bar" class="pure-u-1-2">
            In the next 5 questions, you will observe 5 circles
            illustrating energy consumption patterns of a household over 24 hours. You can see an <b>example</b> circle above.
            <br><br>
        </div>
        <div class="pure-u-18-24" id="cr-circle-div">
            <div class="circle"></div>
        </div>
        <div class="pure-u-1-2">
            The value in the middle of the circle shows time of the day in the 24-hour clock system.
            <br><br>
            The color of the circle indicates the deviation from the optimal energy consumption level at the given time:
            <ul>
                <li><b style="color: #FF0000">Red</b> means the energy consumption is significantly higher than optimal</li>
                <li><b style="color: #FF430B">Orange</b> means the energy consumption is higher than optimal</li>
                <li><b style="color: #FFF200">Yellow</b> means the energy consumption is within the optimal range</li>
                <li><b style="color: #67B304">Light Green</b> means the energy consumption is lower than optimal</li>
                <li><b style="color: #1E9600">Green</b> means the energy consumption is significantly lower than optimal</li>
            </ul>
            <br>
            <b>We ask you to observe the energy consumption patterns and evaluate them in terms of energy efficiency
                on a scale from 1 (very inefficient) to 5 (very efficient).</b>
            <br><br>
            <button id="cr-ok-btn" class="pure-button pure-button-primary">OK</button>
        </div>
    </div>
    <div id="main" class="pure-u-1">
        <div class="pure-u-18-24" id="main-title"><h3 id="main-title-text">Question 1</h3></div>
        <div class="pure-u-18-24" id="container"></div>
        <div class="pure-u-18-24" id="circle-div">
            <div id="main-circle" class="circle"></div>
            <br>
            <i>Click or tap the circle to replay the pattern</i>
        </div>
        <div id="nav-bar" class="pure-u-1">
            Evaluate the energy consumption pattern on a scale from 1 to 5<br>
            Where 1 - very inefficient and 5 - very efficient<br>
            <form id="options" class="pure-form">
                <h2 id="slider-value">1</h2>
                <input type="range" class="slider" min="1" max="5" value="1" id="slider" oninput="slider_update()" style="margin-bottom: 1em">
            </form>
           <button id="next-btn" class="pure-button pure-button-primary">Next</button>
        </div>
    </div>
</div>
<script>

  $(function() {

    var ticks_number = -24,
      updateInterval = 500,

      test_values = [
        [1.93, 2.15, 2.94, 2.47, 2.17, 2.04, 1.78, 1.74, 1.75, 1.82, 1.92, 2.13,
         1.84, 2.1 , 2.07, 2.14, 1.31, 2.03, 2.46, 3.3 , 2.48, 3.28, 2.67, 1.88],

        [1.93, 2.15, 2.94, 2.47, 2.17, 2.04, 1.78, 1.74, 1.75, 1.82, 1.92, 2.13,
         1.84, 2.1 , 2.07, 2.14, 1.31, 2.03, 2.46, 3.3 , 2.48, 3.28, 2.67, 1.88],

        [1.9541335, 2.1319294, 2.372326 , 2.7322118, 2.454658 , 2.2037084,
          2.2703452, 2.2503252, 2.5018969, 2.2098153, 1.8117917, 1.9025755,
          2.1300905, 2.0907607, 2.1464567, 2.1091847, 2.1766121, 1.7145771,
          2.1746511, 2.5089355, 3.1340084, 2.4908762, 2.752179 , 2.5249949]
      ],

      //green, red, yellow, red, green
      values = [
        [5.05, 4.04, 3.71, 3.65, 3.78, 3.51, 3.5 , 3.61, 3.56, 3.78, 3.92, 3.92,
         3.51, 3.82, 4.37, 4.33, 5.38, 4.45, 3.78, 3.77, 3.77, 3.38, 3.69, 3.32],

        [1.65, 1.37, 1.7 , 1.39, 1.52, 1.97, 1.7 , 2.2 , 1.44, 1.58, 1.51, 1.33,
         1.36, 1.29, 1.18, 0.8 , 0.48, 0.82, 1.04, 1.5 , 1.2 , 1.26, 2.95, 1.61],

        [2.86, 2.61, 2.41, 2.51, 2.52, 2.69, 2.93, 2.2 , 2.57, 2.43, 2.37, 2.27,
         2.02, 2.27, 2.33, 2.32, 2.41, 3.56, 2.64, 3.31, 4.25, 3.63, 2.44, 2.17],

        [1.55, 3.36, 3.73, 2.5, 1.61, 1.96, 2.14, 2, 2.03, 1.61, 1.59, 1.48,
         1.15, 0.81, 0.81, 1.78, 1.26, 1.3 , 0.95, 2.01, 1.62, 1.84, 1.25, 1.57],

        [2.13, 1.73, 4.22, 2, 1.81, 2.06, 1.79, 2.24, 2.26, 2.18, 2.04, 2.17,
         2.12, 1.78, 2.08, 2.09, 2.3 , 2.38, 2.27, 2.34, 2.34, 2.5, 2.31, 1.77],

        [5.1963162, 4.946594, 4.4280944, 4.357355, 4.3363223, 4.275125 ,
          4.247508 , 4.2283516, 4.2949014, 4.455449 , 4.7483935, 4.5475206,
          4.4074163, 4.387526 , 4.568726 , 4.8903065, 4.6546235, 5.0185633,
          4.891816 , 4.6200433, 4.5191307, 4.4533234, 4.20131  , 4.4082313],

        [1.0550658, 1.3501303, 1.1187567, 1.0346017, 1.0181652, 1.0591236,
          1.2901689, 1.2925715, 1.5269339, 1.2092066, 1.1108791, 1.346024 ,
          1.2608874, 1.204397 , 1.2608585, 1.1074979, 0.9938548, 0.7703088,
          0.895992 , 1.0072787, 1.1989686, 1.1378539, 1.1322845, 1.8702364],

        [2.271282 , 2.6193545, 2.6381369, 2.434347 , 2.4632728, 2.5982292,
          2.703333 , 2.8180144, 2.490032 , 2.533498 , 2.4752178, 2.4384282,
          2.4548442, 2.250089 , 2.4150057, 2.5472186, 2.4676652, 2.3992484,
          3.151496 , 2.6195912, 3.015508 , 3.655642 , 3.1600928, 2.4054399],

        [1.3833141, 1.1595097, 2.2052493, 2.121164 , 1.5811672, 1.3997424,
          1.436622 , 1.5452194, 1.4950805, 1.4673462, 1.2995046, 1.2145141,
          1.3021291, 1.1419684, 0.9463441, 0.8608955, 1.3605021, 1.2704045,
          1.2003503, 1.1535869, 1.50088  , 1.6167996, 1.5199864, 1.2747772],

        [2.6232414, 2.5745857, 2.4208436, 3.7539895, 2.2958841, 1.912842 ,
          2.312843 , 2.2608085, 2.3873942, 2.4338176, 2.333554 , 2.3163717,
          2.2895875, 2.3309991, 2.1598759, 2.3251917, 2.4806619, 2.6133337,
          2.6400282, 2.5695744, 2.5781972, 2.5546312, 2.485899 , 2.416769]
      ],
      question = 0,
      responses = {};

    $('#welcome-form').submit(function(e) {
      e.preventDefault();
      // get all the inputs into an array.
      var inputs = $('#welcome-form :input');
      responses["age"] = inputs[0]['value'];
      responses["sex"] = inputs[1]['value'];
      $("#welcome-msg").remove();
      $("#chart-info").css('display', 'block');
      render_test_chart();
    });

    $("#main-circle").click(function () {
      render_circle();
    });

    $("#ci-ok-btn").click(function () {
      $("#chart-info").remove();
      $("#main").css('display', 'block');
      render_chart();
    });

    $("#cr-ok-btn").click(function () {
      $("#circle-info").remove();
      $("#main").css('display', 'block');
      $("#circle-div").css('display', 'block');
      render_circle();
    });

    $("#finish-btn").click(function () {
      console.log(responses);
      $.ajax({
        type: "POST",
        url: "/response",
        dataType: "json",
        contentType: "application/json",
        processData: false,
        data: JSON.stringify(responses),
        failure: function(errMsg){console.log("Error: " + errMsg)},
        success: function(data){console.log(data);}
      });
      $("#finish-msg").remove();
      $("#bye").css('display', 'block');
    });

    $("#next-btn").click(function () {

      responses["Q" + (question + 1)] = $('#slider').val();

      uncheck_rb();
      question += 1;
      $("#main-title-text").text("Question " + (question+1));
      switch (question) {
        case 1:
        case 2:
        case 3:
        case 4:
          render_chart();
          break;
        case 5:
          $("#container").remove();
          $("#main").css('display', 'none');
          $("#circle-info").css('display', 'block');
          $("#cr-circle-div").css('display', 'block');
          render_test_circle();
          break;
        case 6:
        case 7:
        case 8:
        case 9:
          render_circle();
          break;
        case 10:
          $("#main").remove();
          $("#finish-msg").css('display', 'block');
          break;
        default:
      }
    });

    function render_chart() {
      $("#next-btn").attr("disabled", true);
      Highcharts.chart('container', {
        chart: {
          type: 'line',
          animation: Highcharts.svg, // don't animate in old IE
          marginRight: 10,
          events: {
            load: function () {
              var series = this.series[0];
              var j = 0;
              var IntervalId = setInterval(function () {
                var y = values[question][j];
                series.addPoint(y, true, true);
                j = j + 1;
                if (j == values[question].length) {
                  clearInterval(IntervalId);
                  $("#next-btn").attr("disabled", false);
                }
              }, updateInterval);
            }
          }
        },

        title: {
          text: 'Real-time Energy Consumption'
        },
        xAxis: {
          title: {
            text: 'Hour'
          },
          min: 0,
          max: 23,
          tickInterval: 1
        },
        yAxis: {
          title: {
            text: 'kWh'
          },
          labels: {
            enabled: false
          },
          plotLines: [{
            value: 0,
            width: 1,
            color: '#003c8f'
          }]
        },
        tooltip: {
          headerFormat: '<b>{series.name}</b><br/>',
          pointFormat: ''
        },
        legend: {
          enabled: false
        },
        exporting: {
          enabled: false
        },
        series: [{
          name: 'Energy consumption',
          color: '#003c8f',
          data: (function () {
            // generate an array of random data
            var data = [], i;

            for (i = ticks_number; i <= 0; i += 1) {
              data.push({
                x: null,
                y: null
              });
            }
            return data;
          }())
        }]
      });

    }

    function render_test_chart() {
      Highcharts.chart('ci-container', {
        chart: {
          type: 'line',
          animation: Highcharts.svg, // don't animate in old IE
          marginRight: 10,
          events: {
            load: function () {
              var series = this.series[0];
              var j = 0;
              var IntervalId = setInterval(function () {
                var y = test_values[0][j];
                series.addPoint(y, true, true);
                j = j + 1;
                if (j == test_values[0].length) {
                  clearInterval(IntervalId);
                }
              }, updateInterval);
            }
          }
        },

        title: {
          text: 'Real-time Energy Consumption'
        },
        xAxis: {
          title: {
            text: 'Hour'
          },
          min: 0,
          max: 23,
          tickInterval: 1
        },
        yAxis: {
          title: {
            text: 'kWh'
          },
          labels: {
            enabled: false
          },
          plotLines: [{
            value: 0,
            width: 1,
            color: '#003c8f'
          }]
        },
        tooltip: {
          headerFormat: '<b>{series.name}</b><br/>',
          pointFormat: ''
        },
        legend: {
          enabled: false
        },
        exporting: {
          enabled: false
        },
        series: [{
          name: 'Energy consumption',
          color: '#003c8f',
          data: (function () {
            // generate an array of random data
            var data = [], i;

            for (i = ticks_number; i <= 0; i += 1) {
              data.push({
                x: null,
                y: null
              });
            }
            return data;
          }())
        }]
      });

    }

    function render_circle(){
      $("#next-btn").attr("disabled", true);
      $("#main-circle").css("pointer-events", 'none');
      var j = 0;
      var IntervalId = setInterval(function () {
        var actual = values[question-5][j];
        var predicted = values[question][j];

        if (predicted * 0.9 <= actual && predicted * 1.1 > actual) {
          $(".circle").css('background-color', '#FFF200')
            .text(j + ":00");
        }
        else if (predicted * 1.1 <= actual && predicted * 1.25 > actual) {
          $(".circle").css('background-color', '#FF9E0F')
            .text(j + ":00");
        }
        else if (predicted * 1.25 <= actual && actual < predicted * 1.5) {
          $(".circle").css('background-color', '#FF430B')
            .text(j + ":00");
        }
        else if (predicted * 1.5 <= actual) {
          $(".circle").css('background-color', '#FF0000')
            .text(j + ":00");
        }
        else if (predicted * 0.75 <= actual && predicted * 0.9 > actual) {
          $(".circle").css('background-color', '#67B304')
            .text(j + ":00");
        }
        else if (actual < predicted * 0.75) {
          $(".circle").css('background-color', '#1E9600')
            .text(j + ":00");
        }

        j = j + 1;
        if (j == values[question].length) {
          clearInterval(IntervalId);
          $("#next-btn").attr("disabled", false);
          $("#main-circle").css("pointer-events", 'auto');
        }
      }, updateInterval+250);
    }

    function render_test_circle() {
      $("#cr-ok-btn").attr("disabled", true);
      var j = 0;
      var IntervalId = setInterval(function () {
        var actual = test_values[1][j];
        var predicted = test_values[2][j];

        if (predicted * 0.9 <= actual && predicted * 1.1 > actual) {
          $(".circle").css('background-color', '#FFF200')
            .text(j + ":00");
        }
        else if (predicted * 1.1 <= actual && predicted * 1.25 > actual) {
          $(".circle").css('background-color', '#FF9E0F')
            .text(j + ":00");
        }
        else if (predicted * 1.25 <= actual && actual < predicted * 1.5) {
          $(".circle").css('background-color', '#FF430B')
            .text(j + ":00");
        }
        else if (predicted * 1.5 <= actual) {
          $(".circle").css('background-color', '#FF0000')
            .text(j + ":00");
        }
        else if (predicted * 0.75 <= actual && predicted * 0.9 > actual) {
          $(".circle").css('background-color', '#67B304')
            .text(j + ":00");
        }
        else if (actual < predicted * 0.75) {
          $(".circle").css('background-color', '#1E9600')
            .text(j + ":00");
        }

        j = j + 1;
        if (j == values[question].length) {
          $("#cr-ok-btn").attr("disabled", false);
          clearInterval(IntervalId);
        }
      }, updateInterval+250);

    }

    function uncheck_rb() {
      //$("#options input[type=radio]").prop('checked',false);
      $("#slider").val(0);
      slider_update();
    }

  });

  function slider_update() {
    $("#slider-value").text($("#slider").val());
  };

</script>
</body>
</html>